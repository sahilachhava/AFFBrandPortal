<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>E-Tickets | The Food Fest</title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<style>
  /* For Firefox */
  input[type='number'] {
      -moz-appearance:textfield;
  }
  /* Webkit browsers like Safari and Chrome */
  input[type=number]::-webkit-inner-spin-button,
  input[type=number]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
  }
  .lds-hourglass {
  display: inline-block;
  position: relative;
  width: 80px;
  height: 80px;
  }
.lds-hourglass:after {
  content: " ";
  display: block;
  border-radius: 50%;
  width: 0;
  height: 0;
  margin: 8px;
  box-sizing: border-box;
  border: 32px solid #ff0000;
  border-color: #00ff00 transparent #ff0000 transparent;
  animation: lds-hourglass 1.2s infinite;
}
@keyframes lds-hourglass {
  0% {
    transform: rotate(0);
    animation-timing-function: cubic-bezier(0.55, 0.055, 0.675, 0.19);
  }
  50% {
    transform: rotate(900deg);
    animation-timing-function: cubic-bezier(0.215, 0.61, 0.355, 1);
  }
  100% {
    transform: rotate(1800deg);
  }
}
tr {
  text-align: center;
}
</style>
<script src="assets/webfont.js" type="3045021b30ea9e5a04cf05b1-text/javascript"></script>
<script type="3045021b30ea9e5a04cf05b1-text/javascript">
  WebFont.load({
    google: {"families":["Montserrat:400,500,600,700","Noto+Sans:400,700"]},
    active: function() {
        sessionStorage.fonts = true;
    }
  });
</script>
<link rel="apple-touch-icon" sizes="180x180" href="assets/img/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="assets/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="assets/img/favicon-16x16.png">

<link rel="stylesheet" href="assets/vendors/css/base/bootstrap.min.css">
<link rel="stylesheet" href="assets/vendors/css/base/elisyam-1.5.min.css">
<link rel="stylesheet" href="assets/css/datatables/datatables.min.css">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]-->
</head>
<body id="page-top">

<div id="preloader">
<div class="canvas">
<img src="assets/img/logo.png" alt="logo" class="loader-logo">
<div class="spinner"></div>
</div>
</div>

<div class="page">
<div class="page-content d-flex align-items-stretch">
<div class="content-inner compact">
<div class="container-fluid">

<div class="row">
<div class="page-header">
<div class="d-flex align-items-center">
  <h2 class="page-header-title"><a href="eTickets.html">AFF E-Tickets</a></h2>
<div>
<div class="page-header-tools">
  <a class="btn btn-gradient-01" href="dashboard.html">Back to Dashboard</a>
</div>
</div>
</div>
</div>
</div>

<div class="row">
<div class="col-xl-12">
<!-- Page Starts -->

<div class="widget has-shadow">
<div class="widget-header bordered no-actions d-flex align-items-center">
  <h4>Complimentory E-Tickets</h4>
</div>
<div class="widget-body">
  <ul class="nav nav-tabs nav-fill" role="tablist">
  <li class="nav-item">
    <a class="nav-link active" id="just-tab-1" data-toggle="tab" href="#j-tab-1" role="tab" aria-controls="j-tab-1" aria-selected="true">3rd Jan (Day 1)</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="just-tab-2" data-toggle="tab" href="#j-tab-2" role="tab" aria-controls="j-tab-2" aria-selected="false">4th Jan (Day 2)</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="just-tab-3" data-toggle="tab" href="#j-tab-3" role="tab" aria-controls="j-tab-3" aria-selected="false">5th Jan (Day 3)</a>
  </li>
  <!-- <li class="nav-item">
    <a class="nav-link disabled">Shared</a>
  </li> -->
  </ul>
  <div class="tab-content pt-3">
    <div class="tab-pane fade show active" id="j-tab-1" role="tabpanel" aria-labelledby="just-tab-1">
      <div class="widget has-shadow">
        <div class="widget-body">
        <div class="table-responsive">
        <table class="table table-bordered mb-0">
        <thead>
        <tr>
        <th>E-Ticket Date</th>
        <th>E-Ticket ID</th>
        <th>E-Ticket Valid for</th>
        <th>E-Ticket Amount</th>
        <th>Share Now</th>
        <th>Status</th>
        </tr>
        </thead>
        <tbody id="day1">
            <tr><td style="align-content: center;" colspan="5">No Tickets Found</td></tr>
        </tbody>
        </table>
        </div>
        </div>
      </div>
    </div>
    <div class="tab-pane fade" id="j-tab-2" role="tabpanel" aria-labelledby="just-tab-2">
      <div class="widget has-shadow">
        <div class="widget-body">
        <div class="table-responsive">
        <table class="table table-bordered mb-0">
        <thead>
        <tr>
        <th>E-Ticket Date</th>
        <th>E-Ticket ID</th>
        <th>E-Ticket Valid for</th>
        <th>E-Ticket Amount</th>
        <th>Share Now</th>
        <th>Status</th>
        </tr>
        </thead>
        <tbody id="day2">
          <tr><td style="align-content: center;" colspan="5">No Tickets Found</td></tr>
        </tbody>
        </table>
        </div>
        </div>
      </div>
    </div>
    <div class="tab-pane fade" id="j-tab-3" role="tabpanel" aria-labelledby="just-tab-3">
      <div class="widget has-shadow">
        <div class="widget-body">
        <div class="table-responsive">
        <table class="table table-bordered mb-0">
        <thead>
          <tr>
            <th>E-Ticket Date</th>
            <th>E-Ticket ID</th>
            <th>E-Ticket Valid for</th>
            <th>E-Ticket Amount</th>
            <th>Share Now</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="day3">
            <tr><td style="align-content: center;" colspan="5">No Tickets Found</td></tr>
        </tbody>
        </table>
        </div>
        </div>
      </div>
    </div>
  </div>
</div>
</div>

<!-- Page Ends -->
</div>
</div>

<footer class="main-footer">
  <div class="row">
    <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 d-flex align-items-center justify-content-xl-start justify-content-lg-start justify-content-md-start justify-content-center">
      <p class="text-gradient-02">Design & Developed By</p> &nbsp;&nbsp;<a style="font-size: 90%;color:crimson" href="https://github.com/sahilachhava" target="_blank">Sahil Achhava</a>
    </div>
  </div>
</footer>

<div id="textMessageModal"></div>
<div id="whatsappModal"></div>

<!-- success modal -->
<div id="success-modal" class="modal fade">
<div class="modal-dialog modal-dialog-centered">
<div class="modal-content">
<div class="modal-body text-center">
<div class="sa-icon sa-success animate" style="display: block;">
<span class="sa-line sa-tip animateSuccessTip"></span>
<span class="sa-line sa-long animateSuccessLong"></span>
<div class="sa-placeholder"></div>
<div class="sa-fix"></div>
</div>
<div class="section-title mt-5 mb-2">
<h2 class="text-gradient-02">E-Ticket sent!</h2>
</div>
<p class="mb-5">The e-ticket was sent successfully</p>
<button type="button" class="btn btn-shadow mb-3" data-dismiss="modal">Ok</button>
</div>
</div>
</div>
</div>

<a href="#" class="go-top"><i class="la la-arrow-up"></i></a>

</div>
</div>
</div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="assets/vendors/js/base/core.min.js" type="3045021b30ea9e5a04cf05b1-text/javascript"></script>
<script src="assets/vendors/js/datatables/datatables.min.js" type="3045021b30ea9e5a04cf05b1-text/javascript"></script>
<script src="assets/vendors/js/datatables/dataTables.buttons.min.js" type="3045021b30ea9e5a04cf05b1-text/javascript"></script>
<script src="assets/vendors/js/datatables/jszip.min.js" type="3045021b30ea9e5a04cf05b1-text/javascript"></script>
<script src="assets/vendors/js/datatables/buttons.html5.min.js" type="3045021b30ea9e5a04cf05b1-text/javascript"></script>
<script src="assets/vendors/js/datatables/pdfmake.min.js" type="3045021b30ea9e5a04cf05b1-text/javascript"></script>
<script src="assets/vendors/js/datatables/vfs_fonts.js" type="3045021b30ea9e5a04cf05b1-text/javascript"></script>
<script src="assets/vendors/js/datatables/buttons.print.min.js" type="3045021b30ea9e5a04cf05b1-text/javascript"></script>
<script src="assets/vendors/js/nicescroll/nicescroll.min.js" type="3045021b30ea9e5a04cf05b1-text/javascript"></script>
<script src="assets/vendors/js/app/app.min.js" type="3045021b30ea9e5a04cf05b1-text/javascript"></script>
<script src="assets/js/components/tables/tables.js" type="3045021b30ea9e5a04cf05b1-text/javascript"></script>
<script src="assets/rocket-loader.min.js" data-cf-settings="3045021b30ea9e5a04cf05b1-|49" defer=""></script>

<script src="https://www.gstatic.com/firebasejs/7.5.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.5.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.5.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.5.0/firebase-storage.js"></script>
<script src="firebase.js"></script>
<script>
  var session = sessionStorage.getItem("brandEmail");
  if(session == null || session == "") {
    window.location.href = "index.html";
  }
</script>
<script>
    var session = sessionStorage.getItem("brandEmail");
    db.collection('eticket').doc('ticketCodes').collection('day1')
    .where("brandEmail", "==", session).get().then((snapshot) => {
      if(snapshot.size==0){
        alert("No Tickets Issued or Found");
        window.location.href = "dashboard.html";
      }
      $('#day1').empty();
      snapshot.forEach((doc) => {
        const ticketData = doc.data();
        if(ticketData.isShared == false){
          $('#day1').append('<tr>'+
          '<td>'+ticketData.ticketDate+'</td>'+
          '<td><b><span class="text-primary">'+ticketData.ticketCode+'</span></b></td>'+
          '<td>0'+ticketData.totalTickets+' person</td>'+
          '<td>Rs. '+ticketData.totalAmount+'/-</td>'+
            '<td class="td-actions">'+
              '<center><a href="#" onclick="onWhatsApp(\''+ticketData.ticketCode+'\',\'3rd Jan\',\'day1\');"><i class="ion ion-social-whatsapp" data-toggle="modal" data-target="#modal-whatsApp"></i></a></center>'+
            '</td>'+
             '<td style="color: red;" class="td-actions">Not Shared</td>'+
          '</tr>');
        }else{
          $('#day1').append('<tr>'+
          '<td>'+ticketData.ticketDate+'</td>'+
          '<td><b><span class="text-primary">'+ticketData.ticketCode+'</span></b></td>'+
          '<td>0'+ticketData.totalTickets+' person</td>'+
          '<td>Rs. '+ticketData.totalAmount+'/-</td>'+
          '<td class="td-actions">'+
              '<center><a href="#" onclick="onWhatsApp(\''+ticketData.ticketCode+'\',\'3rd Jan\',\'day1\');"><i class="ion ion-social-whatsapp" data-toggle="modal" data-target="#modal-whatsApp"></i></a></center>'+
            '</td>'+
          '<td style="color: green;" class="td-actions">Shared</td>'+
          '</tr>');
        }
      })
    });

    db.collection("eticket").doc('ticketCodes').collection('day2').where("brandEmail", "==", session).get().then((snapshot) => {
      $('#day2').empty();
      snapshot.forEach((doc) => {
        const ticketData = doc.data();
        if(ticketData.isShared == false){
          $('#day2').append('<tr>'+
          '<td>'+ticketData.ticketDate+'</td>'+
          '<td><b><span class="text-primary">'+ticketData.ticketCode+'</span></b></td>'+
          '<td>0'+ticketData.totalTickets+' person</td>'+
          '<td>Rs. '+ticketData.totalAmount+'/-</td>'+
          '<td class="td-actions">'+
            '<center><a href="#" onclick="onWhatsApp(\''+ticketData.ticketCode+'\',\'4th Jan\',\'day2\');"><i class="ion ion-social-whatsapp" data-toggle="modal" data-target="#modal-whatsApp"></i></a></center>'+
          '</td>'+
          '<td style="color: red;" class="td-actions">Not Shared</td>'+
          '</tr>');
        }else{
          $('#day2').append('<tr>'+
          '<td>'+ticketData.ticketDate+'</td>'+
          '<td><b><span class="text-primary">'+ticketData.ticketCode+'</span></b></td>'+
          '<td>0'+ticketData.totalTickets+' person</td>'+
          '<td>Rs. '+ticketData.totalAmount+'/-</td>'+
           '<td class="td-actions">'+
            '<center><a href="#" onclick="onWhatsApp(\''+ticketData.ticketCode+'\',\'4th Jan\',\'day2\');"><i class="ion ion-social-whatsapp" data-toggle="modal" data-target="#modal-whatsApp"></i></a></center>'+
          '</td>'+
          '<td style="color: green;" class="td-actions">Shared</td>'+
          '</tr>');
        }
      })
    });

    db.collection("eticket").doc('ticketCodes').collection('day3').where("brandEmail", "==", session).get().then((snapshot) => {
      $('#day3').empty();
      snapshot.forEach((doc) => {
        const ticketData = doc.data();
        if(ticketData.isShared == false){
          $('#day3').append('<tr>'+
          '<td>'+ticketData.ticketDate+'</td>'+
          '<td><b><span class="text-primary">'+ticketData.ticketCode+'</span></b></td>'+
          '<td>0'+ticketData.totalTickets+' person</td>'+
          '<td>Rs. '+ticketData.totalAmount+'/-</td>'+
          '<td class="td-actions">'+
            '<center><a href="#" onclick="onWhatsApp(\''+ticketData.ticketCode+'\',\'5th Jan\',\'day3\');"><i class="ion ion-social-whatsapp" data-toggle="modal" data-target="#modal-whatsApp"></i></a></center>'+
          '</td>'+
          '<td style="color: red;" class="td-actions">Not Shared</td>'+
          '</tr>');
        }else{
          $('#day3').append('<tr>'+
          '<td>'+ticketData.ticketDate+'</td>'+
          '<td><b><span class="text-primary">'+ticketData.ticketCode+'</span></b></td>'+
          '<td>0'+ticketData.totalTickets+' person</td>'+
          '<td>Rs. '+ticketData.totalAmount+'/-</td>'+
          '<td class="td-actions">'+
            '<center><a href="#" onclick="onWhatsApp(\''+ticketData.ticketCode+'\',\'5th Jan\',\'day3\');"><i class="ion ion-social-whatsapp" data-toggle="modal" data-target="#modal-whatsApp"></i></a></center>'+
          '</td>'+
          '<td style="color: green;" class="td-actions">Shared</td>'+
          '</tr>');
        }
      })
    });
</script>
<script>
  function onWhatsApp(code,day,date){
    $('#whatsappModal').empty();
    $('#whatsappModal').append(
      '<div id="modal-whatsApp" class="modal fade">'+
        '<div class="modal-dialog modal-dialog-centered">'+
        '<div class="modal-content">'+
          '<div class="modal-header">'+
            '<h4 class="modal-title">Share this E-Ticket</h4>'+
            '<button type="button" class="close" data-dismiss="modal">'+
              '<span aria-hidden="true">×</span>'+
              '<span class="sr-only">close</span>'+
            '</button>'+
          '</div>'+
          '<div class="modal-body">'+
            '<center>'+
              '<h3>E-Ticket ID: '+code+'</h3><br>'+
              '<h5>Share this E-Ticket to your friends and family on <b>Whatsapp</b></h5>'+
             '</center><br>'+
            '<form id="modelForm">'+
            '<input type="hidden" id="redeemCode" value="'+code+'" />'+
            '<input type="hidden" id="day" value="'+day+'" />'+
             '<input type="hidden" id="date" value="'+date+'" />'+
            '<div class="form-group row d-flex align-items-center mb-5">'+
              '<label class="col-lg-2 form-control-label d-flex justify-content-lg-end">Name<span style="color: red">*</span></label>'+
              '<div class="col-lg-9">'+
                '<input type="text" id="personName" value="" class="form-control" placeholder="Enter person name" required>'+
              '</div>'+
            '</div>'+
            '<div class="form-group row d-flex align-items-center mb-5">'+
                '<label class="col-lg-2 form-control-label d-flex justify-content-lg-end">Phone<span style="color: red">*</span></label>'+
                '<div class="col-lg-9">'+
                  '<input type="number" id="personNumber" value="" class="form-control" placeholder="Enter phone number" required>'+
                '</div>'+
              '</div>'+
          '</div>'+
          '<div class="modal-footer">'+
            '<input type="button" class="btn btn-shadow" id="closeModal" data-dismiss="modal" value="Close" />'+
            '<input type="submit" onclick="sendTicketOnWhatsapp();" data-toggle="modal" data-target="#success-modal" class="btn btn-danger" value="Share Now" />'+
          '</div>'+
        '</form>'+
        '</div>'+
        '</div>'+
      '</div>'
    );
  }

  function onTextMessage(code){
    $('#textMessageModal').empty();
    $('#textMessageModal').append(
      '<div id="modal-textMessage" class="modal fade">'+
        '<div class="modal-dialog modal-dialog-centered">'+
        '<div class="modal-content">'+
          '<div class="modal-header">'+
            '<h4 class="modal-title">Share this E-Ticket</h4>'+
            '<button type="button" class="close" data-dismiss="modal">'+
              '<span aria-hidden="true">×</span>'+
              '<span class="sr-only">close</span>'+
            '</button>'+
          '</div>'+
          '<div class="modal-body">'+
            '<center>'+
              '<h3>E-Ticket ID: '+code+'</h3><br>'+
              '<h5>Share this E-Ticket to your friends and family in <b>Text</b></h5>'+
             '</center><br>'+
            '<form id="modelForm">'+
            '<input type="hidden" id="redeemCode" value="'+code+'" />'+
            '<div class="form-group row d-flex align-items-center mb-5">'+
              '<label class="col-lg-2 form-control-label d-flex justify-content-lg-end">Name<span style="color: red">*</span></label>'+
              '<div class="col-lg-9">'+
                '<input type="text" id="personName" value="" class="form-control" maxlength="15" placeholder="Enter person name" required>'+
              '</div>'+
            '</div>'+
            '<div class="form-group row d-flex align-items-center mb-5">'+
                '<label class="col-lg-2 form-control-label d-flex justify-content-lg-end">Phone<span style="color: red">*</span></label>'+
                '<div class="col-lg-9">'+
                  '<input type="number" id="personNumber" value="" class="form-control" maxlength="10" placeholder="Enter phone number" required>'+
                '</div>'+
              '</div>'+
          '</div>'+
          '<div class="modal-footer">'+
            '<input type="button" class="btn btn-shadow" id="closeModal" data-dismiss="modal" value="Close" />'+
            '<input type="submit" onclick="sendTicketOnText();" class="btn btn-danger" data-toggle="modal" data-target="#success-modal" value="Share Now" />'+
          '</div>'+
        '</form>'+
        '</div>'+
        '</div>'+
      '</div>'
    );
  }
</script>
<script>
  console.log("Using Version 1.5");
  function sendTicketOnWhatsapp(){
    var session = sessionStorage.getItem("brandEmail");
    var brand = sessionStorage.getItem('brandName');
    var ticket = document.getElementById('redeemCode').value;
    var day = document.getElementById('day').value;
    var date = document.getElementById('date').value;
    var name = document.getElementById('personName').value;
    var number = document.getElementById('personNumber').value;
    if(name==""){
      alert("Please enter Name");
    }else if(number==""){
      alert("Please enter mobile number");
    }else{
      //{'ticketCode':"+ticket+",'ticketDay':"+date+",'userNumber':"+number+",'totalTickets':1}
      // var finalAPI = "https://cutt.ly/api/api.php?key=de81cd498baac171aaea99e47caa7f756d768&short="+qrAPI;
      // var option = {
      //   method: "GET",
      //   headers: {
      //     "Access-Control-Allow-Methods": "GET",
      //     "Access-Control-Allow-Origin": "https://brand.thefoodfest.in/eTickets.html",
      //   },
      //   mode: 'cors', 
      // };
      // fetch(finalAPI, option).then((response) => {
      //   response.json().then((data) => {
      //      console.log("String -> "+JSON.stringify(data));
      //   }).catch((error) => {
      //     console.log("in"+JSON.stringify(error));
      //   })
      // });
      // var shortLink = await response["url"]["shortLink"];
      // alert(shortLink);
      // $.get("https://cutt.ly/api/api.php?key=de81cd498baac171aaea99e47caa7f756d768&short="+qrAPI, function(data, status){
      //   alert(data.json());
      // });
      var qrAPI = "https://thefoodfest.in/qr.html?action="+ticket+":"+date;
      var draftText = "Dear "+name+", You are invited to AFF-2020 on "+day+" by "+brand+", Your E-Ticket is " +ticket+". Valid for 1 Person Only, Click this link for E-Ticket QR Code: "+qrAPI;
      var message = encodeURI(draftText);
      var whatsappAPI = "https://api.whatsapp.com/send?phone=+91"+number+"&text="+message;
      window.open(whatsappAPI,'_blank');
      $('#closeModal').click();
      db.collection("eticket").doc('ticketCodes').collection(date)
      .doc(ticket).update({
        personName: name,
        personNumber: number,
        sharedOn: "WhatsApp",
        isShared: true,
      }).then(()=>{
        location.reload(true);
      });
    }
  }

  function sendTicketOnText(){
    var session = sessionStorage.getItem("brandEmail");
    var ticket = document.getElementById('redeemCode').value;
    var name = document.getElementById('personName').value;
    var number = document.getElementById('personNumber').value;
    if(name==""){
      alert("Please enter Name");
    }else if(number==""){
      alert("Please enter mobile number");
    }else{
      var brand = sessionStorage.getItem('brandName');
      var message = "Dear\ "+name+",\ You\ are\ invited\ to\ AFF-2020\ by\ "+brand+",\ Your\ E-Ticket\ is\ " +ticket+"\ Valid\ for\ 1\ Person\ Only";
      var messageAPI = "https://mobicomm.dove-sms.com//submitsms.jsp?user=ACTIVEAD&key=dee308a10fXX&mobile=+91"+number+"&message="+message+"&senderid=AFFTKT&accusage=1";
      fetch(messageAPI)
      .then(function(data) {
        $('#closeModal').click();
        db.collection("eticket").doc("ticketCodes").collection(day).doc(ticket).update({
          personName: name,
          personNumber: number,
          sharedOn: "Text",
          isShared: true
        }).then(()=>{
          location.reload(true);
        })
      })
    }
  }
</script>
</body>
</html>