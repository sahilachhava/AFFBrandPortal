<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Brand Digital Portal | The Food Fest</title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<style>
  /* For Firefox */
  input[type='number'] {
      -moz-appearance:textfield;
  }
  /* Webkit browsers like Safari and Chrome */
  input[type=number]::-webkit-inner-spin-button,
  input[type=number]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
  }
  #progressUpload {
    -webkit-appearance: none;
    appearance: none;
    width: 50%;
    margin-bottom: 10px;
  }
  #progressUpload {
    -webkit-appearance: none;
    appearance: none;
    width: 50%;
    margin-bottom: 10px;
  }
  .loader {
    border: 16px solid #f3f3f3;
    border-radius: 50%;
    border-top: 16px solid gray;
    border-bottom: 16px solid gray;
    width: 2px;
    height: 2px;
    -webkit-animation: spin 2s linear infinite;
    animation: spin 2s linear infinite;
  }

  @-webkit-keyframes spin {
    0% { -webkit-transform: rotate(0deg); }
    100% { -webkit-transform: rotate(360deg); }
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
</style>
<script src="assets/webfont.js" type="27d95d96077262733048a84b-text/javascript"></script>
<script type="27d95d96077262733048a84b-text/javascript">
  WebFont.load({
    google: {"families":["Montserrat:400,500,600,700","Noto+Sans:400,700"]},
    active: function() {
        sessionStorage.fonts = true;
    }
  });
</script>

<link rel="apple-touch-icon" sizes="180x180" href="assets/img/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="assets/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="assets/img/favicon-16x16.png">

<link rel="stylesheet" href="assets/vendors/css/base/bootstrap.min.css">
<link rel="stylesheet" href="assets/vendors/css/base/elisyam-1.5.min.css">
<link rel="stylesheet" href="assets/css/owl-carousel/owl.carousel.min.css">
<link rel="stylesheet" href="assets/css/owl-carousel/owl.theme.min.css">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]-->
</head>
<body id="page-top">

<div id="preloader">
<div class="canvas">
<img src="assets/img/logo.png" alt="logo" class="loader-logo">
<div class="spinner"></div>
</div>
</div>
<div class="page">

<div class="page-content d-flex align-items-stretch">

<div class="container-fluid">
<div class="row flex-row">
<div class="col-xl-3">

<div class="widget has-shadow">
<div class="widget-body">

<div class="mt-5">
  <img src="assets/img/logo.png" alt="..." style="width: 120px;" class="avatar rounded-circle d-block mx-auto">
</div>
<h3 class="text-center mt-3 mb-1 merchantName"></h3>
<p class="text-center merchantId"></p>
<div class="em-separator separator-dashed"></div>
<ul class="nav flex-column">
    <li class="nav-item">
        <a class="nav-link" href="dishPhotos.html"><i class="la la-cloud-upload la-2x align-middle pr-2"></i>Upload Dish Photos</a>
      </li><br>
    <li class="nav-item">
        <a class="nav-link" href="addDish.html"><i class="la la-cutlery la-2x align-middle pr-2"></i>Back to Dish Details</a>
      </li><br>
    <li class="nav-item">
      <a class="nav-link" href="dashboard.html"><i class="la la-arrow-circle-left la-2x align-middle pr-2"></i>Back to Dashboard</a>
    </li>
</ul>

</div>
</div>

</div>

<div class="col-xl-9">
<div class="widget has-shadow">

<div class="widget-header bordered no-actions d-flex align-items-center">
  <h4>Add Dish Photos</h4>
</div>
<div class="widget-body">

<div class="col-10 ml-auto">
<div class="section-title mt-3 mb-3">
  <h4>Upload Dish Photos</h4>
</div>
</div>
<br>
<form class="form-horizontal" id="myUploadForm" enctype="multipart/form-data">
  <div class="form-group row d-flex align-items-center mb-5">
    <label class="col-lg-2 form-control-label d-flex justify-content-lg-end">Dish Photo (1080x1080)<span style="color: red">*</span></label>
    <div class="col-lg-6">
      <input type="file" id="dishPhoto" class="" accept="image/x-png,image/jpeg,image/jpg" placeholder="Upload your dish image" required>
    </div>
    <div class="load"></div>
  </div>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  <progress id="progressUpload" value="0" max="100">0%</progress>

<div class="em-separator separator-dashed"></div>
<div class="text-center">
    <button class="btn btn-gradient-01" id="submitBtn" type="submit"></button>
    <button class="btn btn-shadow" type="reset">Reset</button>
  </div>
</form>
</div>
</div>

</div>
</div>

<footer class="main-footer">
  <div class="row">
    <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 d-flex align-items-center justify-content-xl-start justify-content-lg-start justify-content-md-start justify-content-center">
      <p class="text-gradient-02">Design & Developed By</p> &nbsp;&nbsp;<a style="font-size: 90%;color:crimson" href="https://github.com/sahilachhava" target="_blank">Sahil Achhava</a>
    </div>
  </div>
</footer>

</div>
</div>
</div>

<script src="assets/vendors/js/base/jquery.min.js" type="27d95d96077262733048a84b-text/javascript"></script>
<script src="assets/vendors/js/base/core.min.js" type="27d95d96077262733048a84b-text/javascript"></script>
<script src="assets/vendors/js/nicescroll/nicescroll.min.js" type="27d95d96077262733048a84b-text/javascript"></script>
<script src="assets/vendors/js/owl-carousel/owl.carousel.min.js" type="27d95d96077262733048a84b-text/javascript"></script>
<script src="assets/vendors/js/app/app.min.js" type="27d95d96077262733048a84b-text/javascript"></script>
<script src="assets/js/app/contact/contact.min.js" type="27d95d96077262733048a84b-text/javascript"></script>
<script src="assets/rocket-loader.min.js" data-cf-settings="27d95d96077262733048a84b-|49" defer=""></script>
<script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-storage.js"></script>
<script src="firebase.js"></script>
</body>
<script type="text/javascript">
  var session = sessionStorage.getItem("brandEmail");
  if(session == null || session == "") {
    window.location.href = "index.html";
  }else{
    document.getElementsByClassName("merchantName")[0].innerHTML = sessionStorage.getItem("brandName");
    document.getElementsByClassName("merchantId")[0].innerHTML = sessionStorage.getItem("brandEmail");
  }
</script>
<script>
    document.getElementById("submitBtn").innerHTML = "Save  " + sessionStorage.getItem("dishName");

    const form = document.querySelector('#myUploadForm');
    var dishPhoto = document.getElementById("dishPhoto");

    form.addEventListener('submit', (e)=>{
      e.preventDefault();
      document.getElementsByClassName("load")[0].className = "load loader";
      var session = sessionStorage.getItem("brandEmail");

      var photo = dishPhoto.files[0];
      var img = new Image();
      img.src = window.URL.createObjectURL(photo);

      img.onload = function() {
        if(img.width != 1080 && img.height != 1080){
          alert("Dish Photo should be in 1080px Height and 1080px Width");
          document.getElementsByClassName("load")[0].className = "load";
        }else{
          var extension = photo.name.split('.')[1];
          var id = sessionStorage.getItem("dishId");
          var upload = document.getElementById("progressUpload");
          var photoRef = storageRef.ref('brands/'+session+"/dishImages/"+id+"/image."+extension);

          photoRef.put(photo).then((snapshot) => {
            var percentage = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
            upload.value = percentage;
            snapshot.ref.getDownloadURL().then(function(downloadURL) {
              document.getElementsByClassName("load")[0].className = "load";
              db.collection("brands").doc(session).collection("dishDetails").doc(id).set({
                dishId: id,
                dishName: sessionStorage.getItem("dishName"),
                dishType: sessionStorage.getItem("dishType"),
                dishPrice: sessionStorage.getItem("dishPrice"),
                dishOfferPrice: sessionStorage.getItem("dishOfferPrice"),
                dishDescription: sessionStorage.getItem("dishDescription"),
                isActive: sessionStorage.getItem("isActive") == "Yes" ? true : false,
                dishPhoto: downloadURL,
              }).then(()=>{
                alert("Dish Added Successfully");
                sessionStorage.removeItem("dishId");
                sessionStorage.removeItem("dishName");
                sessionStorage.removeItem("dishType");
                sessionStorage.removeItem("dishPrice");
                sessionStorage.removeItem("dishOfferPrice");
                sessionStorage.removeItem("dishDescription");
                sessionStorage.removeItem("isActive");
                window.location.href = "dashboard.html";
              })
            })
          })
        }
      }
    });
  </script>
</html>